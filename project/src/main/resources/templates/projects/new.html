<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add New Project</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> <!-- Bootstrap CSS -->
    <script src="/script.js"></script>
</head>
<body class="container mt-5">
<h1 class="mb-4">Add a New Project</h1>
<div th:if="${success}" class="alert alert-success">
    <p th:text="${success}"></p>
</div>
<!-- Error Message -->
<div th:if="${error}" class="alert alert-danger">
    <p th:text="${error}"></p>
</div>

<!-- Project Form -->
<form th:action="@{/projects}" th:object="${project}" method="post">
    <div class="mb-3">
        <label for="idProject" class="form-label">Project ID:</label>
        <input type="number" id="idProject" class="form-control" th:field="*{idProject}" required >
    </div>
    <div class="mb-3">
        <label for="name" class="form-label">Project Name:</label>
        <input type="text" id="name" class="form-control" th:field="*{name}" required >
    </div>
    <div class="mb-3">
        <label for="status" class="form-label">Status:</label>
        <select id="status" class="form-select" th:field="*{status}" required >
            <option value="" disabled selected>Select Status</option>
            <option value="finished">finished</option>
            <option value="unfinished">unfinished</option>

        </select>
    </div>
    <h3>Tasks</h3>
    <div id="tasksContainer">
        <!-- Task Assignment Template -->
        <div class="taskAssignment" id="taskAssignmentTemplate" style="'display: none;'">
            <label for="id">task ID:</label>
            <input type="text" th:field="*{taches[0].idTache}" name="tasks[0].idTache" placeholder="Task id" required ><br>

            <label for="description">Task Description:</label>
            <input type="text" th:field="*{taches[0].description}" name="tasks[0].description" placeholder="Task description" required ><br>

            <label for="startDate">Start date:</label>
            <input type="text" th:field="*{taches[0].startDate}" name="tasks[0].start_date" placeholder="start_date" required ><br>

            <label for="endDate">End date:</label>
            <input type="text" th:field="*{taches[0].endDate}" name="tasks[0].end_date" placeholder="end_date" required ><br>
            <input type="hidden" th:field="*{taches[0].idProject}">
                <label for="status" class="form-label">Task Status:</label>
                <select id="statust" class="form-select" th:field="*{taches[0].status}" required>
                    <option value="" disabled selected>Select Status</option>
                    <option value="finished">finished</option>
                    <option value="unfinished">unfinished</option>

                </select>

            <!-- Employee Selection -->
            <label for="employeeFilter">Filter Employees by Speciality:</label>
            <select name="tasks[0].employees[]" id="employeeSelect" oninput="updateEmployeeData(this)" required >
                <th:block th:each="employee : ${employees}">
                    <option th:value="${employee.idEmployee}"
                            th:data-employee="${employee.idEmployee}"
                            th:text="${employee.nom} + ' (' + ${employee.speciality} + ')'">
                    </option>
                </th:block>
            </select>
            <input type="hidden" id="selectedEmployeeData" name="tasks[0].employee" th:field="*{taches[0].employees[0].idEmployee}"/>

            <!-- Equipment Selection -->
            <br><label for="equipmentFilter">Filter Equipment by Name:</label>
            <select name="tasks[0].equipments[]" id="equipmentSelect" oninput="updateEquipmentData(this)"  required >
                <th:block th:each="equipment : ${equipments}">
                    <option th:data-equipment="${equipment.idEquipment}"
                            th:text="${equipment.name}"
                            th:value="${equipment.idEquipment}" ></option>
                </th:block>
            </select>
            <input type="hidden" id="selectedEquiData" name="tasks[0].employee" th:field="*{taches[0].equipments[0].idEquipment}"/>

        </div>
    </div>
<br><br>
    <!-- Submit Project -->
    <button type="submit" class="btn btn-primary">Add Project</button>
</form>
<script>
    function updateEmployeeData(selectElement) {
        var selectedOption = selectElement.options[selectElement.selectedIndex];
        console.log(selectedOption);
        var employeet = selectedOption.getAttribute('data-employee');
        console.log(employeet);
        document.getElementById('selectedEmployeeData').value = employeet;
    }
    function updateEquipmentData(selectElement) {
        var selectedOption = selectElement.options[selectElement.selectedIndex];
        console.log(selectedOption);
        var equi = selectedOption.getAttribute('data-equipment');
        console.log(equi);
        document.getElementById('selectedEquiData').value = equi;
    }
</script>

<!-- Bootstrap JavaScript (optional, for interactive components) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
